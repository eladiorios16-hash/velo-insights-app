<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Calculadora de Desarrollo y Presi贸n Ciclista | Velo Insights</title>
    <meta name="description" content="Calculadora avanzada para ciclismo. Simula platos, pi帽ones, ratios, velocidad, potencia y calcula la presi贸n perfecta de tus neum谩ticos.">
    <meta name="keywords" content="calculadora desarrollo ciclismo, ratio platos pi帽ones, velocidad cadencia ciclismo, presion neumaticos bicicleta, tubeless, w/kg, potencia ciclismo">
    <meta name="author" content="Velo Insights">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <link rel="canonical" href="https://veloinsights.es/calculadora.html">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://veloinsights.es/calculadora.html">
    <meta property="og:title" content="Performance Lab | Velo Insights">
    <meta property="og:description" content="Ajusta desarrollos, descubre tu velocidad estimada y calcula la presi贸n 贸ptima de tus neum谩ticos.">
    <meta property="og:image" content="https://veloinsights.es/assets/default-news.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://veloinsights.es/calculadora.html">
    <meta name="twitter:title" content="Performance Lab | Velo Insights">
    <meta name="twitter:description" content="Ajusta desarrollos, descubre tu velocidad estimada y calcula la presi贸n 贸ptima de tus neum谩ticos.">
    <meta name="twitter:image" content="https://veloinsights.es/assets/default-news.jpg">
    <meta name="theme-color" content="#050505">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/main.css">
    
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        
        input[type=range].slider-cyan { -webkit-appearance: none; background: #27272a; height: 6px; border-radius: 3px; width: 100%; }
        input[type=range].slider-cyan::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #06b6d4; cursor: pointer; border: 3px solid #083344; box-shadow: 0 0 15px rgba(6, 182, 212, 0.5); margin-top: -9px; transition: transform 0.1s; }
        input[type=range].slider-cyan::-webkit-slider-thumb:active { transform: scale(1.1); }

        /* Slider para Presiones */
        input[type=range].slider-purple { -webkit-appearance: none; background: #27272a; height: 6px; border-radius: 3px; width: 100%; }
        input[type=range].slider-purple::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #a855f7; cursor: pointer; border: 3px solid #3b0764; box-shadow: 0 0 15px rgba(168, 85, 247, 0.5); margin-top: -9px; transition: transform 0.1s; }
        input[type=range].slider-purple::-webkit-slider-thumb:active { transform: scale(1.1); }
        
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }

        .glass-panel { background: linear-gradient(180deg, rgba(24, 24, 27, 0.8) 0%, rgba(9, 9, 11, 0.95) 100%); border: 1px solid rgba(63, 63, 70, 0.5); backdrop-filter: blur(10px); }
        .neon-text { text-shadow: 0 0 20px currentColor; }
        
        .btn-gear { transition: all 0.2s; }
        .btn-gear:active { transform: scale(0.9); }

        .btn-terrain { transition: all 0.2s ease; border: 1px solid rgba(168, 85, 247, 0.2); }
        .btn-terrain.active { border-color: #a855f7; background-color: rgba(168, 85, 247, 0.15); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(168, 85, 247, 0.2); }
        
        .btn-terrain-sub { transition: all 0.2s ease; border: 1px solid rgba(168, 85, 247, 0.2); }
        .btn-terrain-sub.active { border-color: #a855f7; background-color: rgba(168, 85, 247, 0.15); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(168, 85, 247, 0.2); }
    </style>
</head>

<body class="bg-[#050505] antialiased text-slate-300 selection:bg-cyan-500/30 selection:text-cyan-200 min-h-screen flex flex-col relative">

    <header class="relative pt-32 md:pt-44 pb-10 px-4 text-center">
        <div class="max-w-4xl mx-auto animate-fade-in-up">
            <p class="text-cyan-500 font-bold tracking-[0.2em] text-[9px] uppercase mb-3">PERFORMANCE LAB</p>
            <h1 class="text-4xl md:text-6xl font-heading text-white italic uppercase tracking-tighter leading-[0.9] drop-shadow-2xl mb-4">
                Transmisi贸n & <span class="text-purple-500">Presiones</span>
            </h1>
            <p class="text-zinc-500 text-sm md:text-base max-w-2xl mx-auto">Calcula tus desarrollos 贸ptimos y la presi贸n exacta de tus neum谩ticos para maximizar la eficiencia.</p>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 md:px-6 pb-20 space-y-12 animate-fade-in-up">

        <div>
            <div class="flex items-center gap-3 mb-6 px-2">
                <div class="w-8 h-8 rounded-full bg-cyan-900/40 border border-cyan-500/30 flex items-center justify-center">
                    <i class="fas fa-cogs text-cyan-400 text-sm"></i>
                </div>
                <h2 class="text-xl md:text-2xl font-black text-white italic uppercase tracking-widest">Gearing Lab</h2>
            </div>

            <section class="glass-panel rounded-3xl p-6 md:p-10 relative overflow-hidden shadow-2xl max-w-5xl mx-auto w-full">
                <div class="absolute top-0 right-0 w-64 h-64 bg-cyan-500/5 rounded-full blur-3xl pointer-events-none"></div>
                
                <div class="text-center mb-8">
                    <p class="text-[10px] font-black text-cyan-500 uppercase tracking-widest mb-2 flex items-center justify-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span> Cadencia Objetivo
                    </p>
                    <div class="flex items-end justify-center gap-2">
                        <span id="rpm-display" class="text-6xl md:text-8xl font-black italic tracking-tighter text-cyan-400 neon-text leading-none transition-colors duration-300">90</span>
                        <span class="text-lg md:text-xl font-bold text-zinc-500 mb-2 md:mb-4">RPM</span>
                    </div>
                    <span id="rpm-status" class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded border border-cyan-500/30 text-cyan-400 bg-cyan-950/30 transition-colors duration-300">ZONA PTIMA</span>
                </div>

                <div class="max-w-2xl mx-auto relative z-10 mb-10">
                    <input type="range" min="40" max="130" value="90" class="slider-cyan" id="rpm-slider">
                    <div class="flex justify-between text-[10px] font-bold text-zinc-600 uppercase mt-4 tracking-widest">
                        <span>40 Atrancado</span>
                        <span>130 Molinillo</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 relative z-10">
                    <div class="border border-zinc-800 rounded-2xl p-4 bg-black/40 flex flex-col justify-center">
                        <label class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-3 text-center">Inclinaci贸n de la V铆a</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setGradient(0, 'Llano 0%')" class="gradient-btn px-2 py-2 bg-zinc-800 border border-zinc-700 rounded-xl text-xs font-bold text-zinc-300 hover:border-cyan-500/50 hover:text-white transition-all">0%</button>
                            <button onclick="setGradient(8, 'Puerto 8%')" class="gradient-btn px-2 py-2 bg-zinc-800 border border-zinc-700 rounded-xl text-xs font-bold text-zinc-300 hover:border-cyan-500/50 hover:text-white transition-all">8%</button>
                            <button onclick="setGradient(12, 'Muro 12%')" class="gradient-btn px-2 py-2 bg-zinc-800 border border-zinc-700 rounded-xl text-xs font-bold text-zinc-300 hover:border-cyan-500/50 hover:text-white transition-all">12%</button>
                        </div>
                    </div>

                    <div class="border border-zinc-800 rounded-2xl p-4 bg-black/40 flex flex-col justify-center items-center">
                        <label class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-3 text-center">Peso (Ciclista + Bici)</label>
                        <div class="flex items-center gap-3">
                            <input type="number" id="system-weight" value="85" min="40" max="150" oninput="this.value=this.value.replace(/[^0-9]/g,''); if(this.value>150)this.value=150; syncWeights();" class="w-20 bg-zinc-900 border border-zinc-700 rounded-xl px-2 py-2 text-xl text-white font-black font-mono text-center focus:border-cyan-500 focus:outline-none transition-colors shadow-inner">
                            <span class="text-xs font-black text-zinc-500 tracking-widest">KG</span>
                        </div>
                    </div>

                    <div class="border border-zinc-800 rounded-2xl p-4 bg-black/40 flex flex-col justify-center items-center relative overflow-hidden group">
                        <div class="absolute inset-0 bg-cyan-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                        <label class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-3 text-center z-10">Compartir Setup</label>
                        <button onclick="copyShareLink()" class="relative z-10 flex items-center justify-center gap-2 w-full bg-zinc-800 hover:bg-cyan-600 text-zinc-300 hover:text-black border border-zinc-700 hover:border-cyan-500 px-4 py-2.5 rounded-xl text-[11px] font-bold uppercase tracking-widest transition-all shadow-lg active:scale-95">
                            <i class="fas fa-link"></i> Copiar Enlace
                        </button>
                    </div>
                </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 items-start mt-8">
                
                <section class="glass-panel rounded-3xl p-5 md:p-8 flex flex-col relative border-t-4 border-t-zinc-700 hover:border-t-cyan-500 transition-colors duration-300">
                    <div class="flex justify-between items-center mb-6 border-b border-zinc-800 pb-4">
                        <h2 class="text-lg font-black text-white italic uppercase tracking-widest">Setup Actual</h2>
                        <span class="text-[10px] font-bold text-zinc-500 bg-zinc-900 px-2 py-1 rounded">OPCIN A</span>
                    </div>

                    <div class="space-y-5 mb-6 flex-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Rueda y Neum谩tico</label>
                                <select id="wheel-a" onchange="toggleCustomWheel('a')" class="w-full bg-black border border-zinc-700 rounded-xl px-3 py-3 text-xs md:text-sm text-white font-mono focus:border-cyan-500 focus:outline-none transition-colors">
                                    <optgroup label="Carretera">
                                        <option value="2105">700 x 25c</option>
                                        <option value="2136" selected>700 x 28c</option>
                                        <option value="2146">700 x 30c</option>
                                        <option value="2155">700 x 32c</option>
                                    </optgroup>
                                    <optgroup label="Gravel">
                                        <option value="2181">700 x 35c</option>
                                        <option value="2224">700 x 40c</option>
                                        <option value="2268">700 x 45c</option>
                                        <option value="2120">650b x 47</option>
                                    </optgroup>
                                    <optgroup label="MTB">
                                        <option value="2298">29" x 2.20"</option>
                                        <option value="2326">29" x 2.40"</option>
                                        <option value="2195">27.5" x 2.20"</option>
                                    </optgroup>
                                    <optgroup label="Avanzado">
                                        <option value="custom"> Rueda Custom (mm)</option>
                                    </optgroup>
                                </select>
                                
                                <div id="custom-wheel-container-a" class="hidden mt-2 relative">
                                    <input type="number" id="custom-wheel-a" value="2150" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-3 py-2.5 text-sm text-white font-mono focus:border-cyan-500 outline-none transition-colors" placeholder="Ej: 2150">
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-[10px] font-bold text-zinc-500">MM</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Grupo de Transmisi贸n</label>
                                <select id="preset-a" class="w-full bg-zinc-900/80 border border-zinc-700 rounded-xl px-3 py-3 text-xs md:text-sm text-cyan-400 font-bold focus:border-cyan-500 focus:outline-none transition-colors">
                                    <option value="custom">锔 Custom / Crear Perfil</option>
                                    <optgroup label="Carretera Est谩ndar">
                                        <option value="shi_compact_11" selected>Shi. 105/Ult 11v (50/34 - 11/34)</option>
                                        <option value="shi_semi_12">Shi. Ultegra/DA 12v (52/36 - 11/30)</option>
                                        <option value="shi_pro_12">Shi. Pro 12v (54/40 - 11/30)</option>
                                        <option value="sram_red_12">SRAM AXS 12v (48/35 - 10/33)</option>
                                        <option value="campy_12">Campagnolo 12v (50/34 - 11/32)</option>
                                    </optgroup>
                                    <optgroup label="Gravel / CX">
                                        <option value="grx_1x">Shi. GRX 1x11 (40T - 11/42)</option>
                                        <option value="sram_xplr">SRAM XPLR 1x12 (40T - 10/44)</option>
                                        <option value="campy_ekar">Campy Ekar 13v (38T - 9/42)</option>
                                    </optgroup>
                                    <optgroup label="MTB">
                                        <option value="shi_xt_1x12">Shimano XT 1x12 (32T - 10/51)</option>
                                        <option value="sram_eagle">SRAM Eagle 1x12 (32T - 10/52)</option>
                                        <option value="shi_mtb_2x">Shimano MTB 2x11 (36/26 - 11/42)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

                        <div id="quick-selects-a" class="p-3 md:p-4 bg-black/40 rounded-xl border border-zinc-800/80 hidden transition-all"></div>

                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-black/60 rounded-xl p-3 border border-zinc-800/80">
                                <label class="block text-[9px] font-black text-zinc-400 uppercase tracking-widest mb-2 text-center">Plato (Dientes)</label>
                                <div class="relative max-w-[110px] mx-auto">
                                    <i class="fas fa-cog absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-500/50 text-base"></i>
                                    <input type="number" id="plato-a" value="50" min="20" max="70" oninput="this.value=this.value.replace(/[^0-9]/g,''); if(this.value>70)this.value=70;" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl pl-9 pr-2 py-2 text-xl md:text-2xl text-white font-black font-mono focus:border-cyan-500 focus:outline-none transition-colors text-center shadow-inner">
                                </div>
                            </div>
                            <div class="bg-black/60 rounded-xl p-3 border border-zinc-800/80">
                                <label class="block text-[9px] font-black text-zinc-400 uppercase tracking-widest mb-2 text-center">Pi帽贸n (Dientes)</label>
                                <div class="relative max-w-[110px] mx-auto">
                                    <i class="fas fa-bullseye absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-500/50 text-base"></i>
                                    <input type="number" id="pinon-a" value="15" min="9" max="60" oninput="this.value=this.value.replace(/[^0-9]/g,''); if(this.value>60)this.value=60;" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl pl-9 pr-2 py-2 text-xl md:text-2xl text-white font-black font-mono focus:border-cyan-500 focus:outline-none transition-colors text-center shadow-inner">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-black/50 rounded-2xl p-4 md:p-5 border border-zinc-800/50 mt-auto">
                        <p class="text-[10px] font-black text-cyan-500 uppercase tracking-widest mb-4 border-b border-zinc-800 pb-2">Telemetr铆a Resultante</p>
                        <div class="flex justify-between items-end mb-4">
                            <span class="text-xs font-bold text-zinc-500 uppercase tracking-widest">Velocidad</span>
                            <div class="flex items-baseline gap-1">
                                <span id="speed-a" class="text-4xl md:text-5xl font-black italic text-white leading-none">0.0</span>
                                <span class="text-xs font-bold text-zinc-500">km/h</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-2 mb-4 text-center border-y border-zinc-800/50 py-3">
                            <div>
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Atrancado (60)</span>
                                <span id="speed-a-60" class="text-sm font-bold font-mono text-red-400">0.0</span>
                            </div>
                            <div class="border-x border-zinc-800/50">
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Crucero (90)</span>
                                <span id="speed-a-90" class="text-sm font-bold font-mono text-emerald-400">0.0</span>
                            </div>
                            <div>
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Molinillo (110)</span>
                                <span id="speed-a-110" class="text-sm font-bold font-mono text-cyan-400">0.0</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 divide-x divide-zinc-800 bg-zinc-900 border border-zinc-800 rounded-lg py-3 relative z-10 text-center items-center shadow-inner">
                            <div class="px-2">
                                <span id="power-label-a" class="block text-[8px] md:text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Potencia (Llano 0%)</span>
                                <span id="power-a" class="text-lg md:text-xl font-black font-mono text-white">0 W</span>
                            </div>
                            <div class="px-2">
                                <span class="block text-[8px] md:text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Relaci贸n W/Kg</span>
                                <span id="wkg-a" class="text-lg md:text-xl font-black font-mono text-cyan-400">0.0</span>
                            </div>
                        </div>

                        <div id="crosschain-warning-a" class="hidden mt-3 p-2 bg-amber-950/40 border border-amber-500/30 rounded text-center text-[9px] font-bold uppercase tracking-widest text-amber-400 animate-pulse">
                            <i class="fas fa-exclamation-triangle mr-1"></i> Cadena Cruzada: Pierdes ~5W por fricci贸n
                        </div>

                        <div class="grid grid-cols-2 gap-4 mt-4 border-t border-zinc-800/50 pt-4">
                            <div>
                                <span class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Avance/Pedalada</span>
                                <span id="dev-a" class="text-lg font-mono font-bold text-zinc-300">0.00m</span>
                            </div>
                            <div class="text-right">
                                <span class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Ratio (Vueltas)</span>
                                <span id="ratio-a" class="text-lg font-mono font-bold text-zinc-300">0.00</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="glass-panel rounded-3xl p-5 md:p-8 flex flex-col relative border-t-4 border-t-zinc-700 hover:border-t-violet-500 transition-colors duration-300">
                    <div class="flex justify-between items-center mb-6 border-b border-zinc-800 pb-4">
                        <h2 class="text-lg font-black text-white italic uppercase tracking-widest">Nuevo Setup</h2>
                        <span class="text-[10px] font-bold text-zinc-500 bg-zinc-900 px-2 py-1 rounded">OPCIN B</span>
                    </div>

                    <div class="space-y-5 mb-6 flex-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Rueda y Neum谩tico</label>
                                <select id="wheel-b" onchange="toggleCustomWheel('b')" class="w-full bg-black border border-zinc-700 rounded-xl px-3 py-3 text-xs md:text-sm text-white font-mono focus:border-violet-500 focus:outline-none transition-colors">
                                    <optgroup label="Carretera">
                                        <option value="2105">700 x 25c</option>
                                        <option value="2136" selected>700 x 28c</option>
                                        <option value="2146">700 x 30c</option>
                                        <option value="2155">700 x 32c</option>
                                    </optgroup>
                                    <optgroup label="Gravel">
                                        <option value="2181">700 x 35c</option>
                                        <option value="2224">700 x 40c</option>
                                        <option value="2268">700 x 45c</option>
                                        <option value="2120">650b x 47</option>
                                    </optgroup>
                                    <optgroup label="MTB">
                                        <option value="2298">29" x 2.20"</option>
                                        <option value="2326">29" x 2.40"</option>
                                        <option value="2195">27.5" x 2.20"</option>
                                    </optgroup>
                                    <optgroup label="Avanzado">
                                        <option value="custom"> Rueda Custom (mm)</option>
                                    </optgroup>
                                </select>

                                <div id="custom-wheel-container-b" class="hidden mt-2 relative">
                                    <input type="number" id="custom-wheel-b" value="2150" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-3 py-2.5 text-sm text-white font-mono focus:border-violet-500 outline-none transition-colors" placeholder="Ej: 2150">
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-[10px] font-bold text-zinc-500">MM</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Grupo de Transmisi贸n</label>
                                <select id="preset-b" class="w-full bg-zinc-900/80 border border-zinc-700 rounded-xl px-3 py-3 text-xs md:text-sm text-violet-400 font-bold focus:border-violet-500 focus:outline-none transition-colors">
                                    <option value="custom">锔 Custom / Crear Perfil</option>
                                    <optgroup label="Carretera Est谩ndar">
                                        <option value="shi_compact_11">Shi. 105/Ult 11v (50/34 - 11/34)</option>
                                        <option value="shi_semi_12" selected>Shi. Ultegra/DA 12v (52/36 - 11/30)</option>
                                        <option value="shi_pro_12">Shi. Pro 12v (54/40 - 11/30)</option>
                                        <option value="sram_red_12">SRAM AXS 12v (48/35 - 10/33)</option>
                                        <option value="campy_12">Campagnolo 12v (50/34 - 11/32)</option>
                                    </optgroup>
                                    <optgroup label="Gravel / CX">
                                        <option value="grx_1x">Shi. GRX 1x11 (40T - 11/42)</option>
                                        <option value="sram_xplr">SRAM XPLR 1x12 (40T - 10/44)</option>
                                        <option value="campy_ekar">Campy Ekar 13v (38T - 9/42)</option>
                                    </optgroup>
                                    <optgroup label="MTB">
                                        <option value="shi_xt_1x12">Shimano XT 1x12 (32T - 10/51)</option>
                                        <option value="sram_eagle">SRAM Eagle 1x12 (32T - 10/52)</option>
                                        <option value="shi_mtb_2x">Shimano MTB 2x11 (36/26 - 11/42)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

                        <div id="quick-selects-b" class="p-3 md:p-4 bg-black/40 rounded-xl border border-zinc-800/80 hidden transition-all"></div>

                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-black/60 rounded-xl p-3 border border-zinc-800/80">
                                <label class="block text-[9px] font-black text-zinc-400 uppercase tracking-widest mb-2 text-center">Plato (Dientes)</label>
                                <div class="relative max-w-[110px] mx-auto">
                                    <i class="fas fa-cog absolute left-3 top-1/2 transform -translate-y-1/2 text-violet-500/50 text-base"></i>
                                    <input type="number" id="plato-b" value="52" min="20" max="70" oninput="this.value=this.value.replace(/[^0-9]/g,''); if(this.value>70)this.value=70;" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl pl-9 pr-2 py-2 text-xl md:text-2xl text-white font-black font-mono focus:border-violet-500 focus:outline-none transition-colors text-center shadow-inner">
                                </div>
                            </div>
                            <div class="bg-black/60 rounded-xl p-3 border border-zinc-800/80">
                                <label class="block text-[9px] font-black text-zinc-400 uppercase tracking-widest mb-2 text-center">Pi帽贸n (Dientes)</label>
                                <div class="relative max-w-[110px] mx-auto">
                                    <i class="fas fa-bullseye absolute left-3 top-1/2 transform -translate-y-1/2 text-violet-500/50 text-base"></i>
                                    <input type="number" id="pinon-b" value="15" min="9" max="60" oninput="this.value=this.value.replace(/[^0-9]/g,''); if(this.value>60)this.value=60;" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl pl-9 pr-2 py-2 text-xl md:text-2xl text-white font-black font-mono focus:border-violet-500 focus:outline-none transition-colors text-center shadow-inner">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-black/50 rounded-2xl p-4 md:p-5 border border-zinc-800/50 mt-auto relative overflow-hidden">
                        <div class="absolute inset-0 bg-violet-500/5 opacity-0 hover:opacity-100 transition-opacity"></div>
                        <p class="text-[10px] font-black text-violet-400 uppercase tracking-widest mb-4 border-b border-zinc-800 pb-2">Telemetr铆a Resultante</p>
                        <div class="flex justify-between items-end mb-4 relative z-10">
                            <span class="text-xs font-bold text-zinc-500 uppercase tracking-widest">Velocidad</span>
                            <div class="flex items-baseline gap-1">
                                <span id="speed-b" class="text-4xl md:text-5xl font-black italic text-white leading-none">0.0</span>
                                <span class="text-xs font-bold text-zinc-500">km/h</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-2 mb-4 text-center border-y border-zinc-800/50 py-3 relative z-10">
                            <div>
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Atrancado (60)</span>
                                <span id="speed-b-60" class="text-sm font-bold font-mono text-red-400">0.0</span>
                            </div>
                            <div class="border-x border-zinc-800/50">
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Crucero (90)</span>
                                <span id="speed-b-90" class="text-sm font-bold font-mono text-emerald-400">0.0</span>
                            </div>
                            <div>
                                <span class="block text-[8px] text-zinc-500 uppercase tracking-widest">Molinillo (110)</span>
                                <span id="speed-b-110" class="text-sm font-bold font-mono text-cyan-400">0.0</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 divide-x divide-zinc-800 bg-zinc-900 border border-zinc-800 rounded-lg py-3 relative z-10 text-center items-center shadow-inner">
                            <div class="px-2">
                                <span id="power-label-b" class="block text-[8px] md:text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Potencia (Llano 0%)</span>
                                <span id="power-b" class="text-lg md:text-xl font-black font-mono text-white">0 W</span>
                            </div>
                            <div class="px-2">
                                <span class="block text-[8px] md:text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Relaci贸n W/Kg</span>
                                <span id="wkg-b" class="text-lg md:text-xl font-black font-mono text-violet-400">0.0</span>
                            </div>
                        </div>

                        <div id="crosschain-warning-b" class="hidden mt-3 p-2 bg-amber-950/40 border border-amber-500/30 rounded text-center text-[9px] font-bold uppercase tracking-widest text-amber-400 animate-pulse relative z-10">
                            <i class="fas fa-exclamation-triangle mr-1"></i> Cadena Cruzada: Pierdes ~5W por fricci贸n
                        </div>

                        <div class="grid grid-cols-2 gap-4 relative z-10 mt-4 border-t border-zinc-800/50 pt-4">
                            <div>
                                <span class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Avance/Pedalada</span>
                                <span id="dev-b" class="text-lg font-mono font-bold text-zinc-300">0.00m</span>
                            </div>
                            <div class="text-right">
                                <span class="block text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Ratio (Vueltas)</span>
                                <span id="ratio-b" class="text-lg font-mono font-bold text-zinc-300">0.00</span>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>

        <div class="mt-20">
            <div class="flex items-center gap-3 mb-6 px-2">
                <div class="w-8 h-8 rounded-full bg-purple-900/40 border border-purple-500/30 flex items-center justify-center">
                    <i class="fas fa-compress-arrows-alt text-purple-400 text-sm"></i>
                </div>
                <h2 class="text-xl md:text-2xl font-black text-white italic uppercase tracking-widest">Tyre Pressure Lab</h2>
            </div>
            <p class="text-zinc-400 text-sm px-2 mb-8 max-w-3xl">El c谩lculo de presi贸n se basa en modelos matem谩ticos de disipaci贸n de energ铆a, adaptando la rigidez del neum谩tico al peso del sistema, tipo de cubierta y la disciplina practicada.</p>

            <section class="glass-panel rounded-3xl p-5 md:p-10 relative overflow-hidden shadow-2xl w-full border-l-4 border-purple-500">
                <div class="absolute top-0 right-0 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl pointer-events-none"></div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 relative z-10">
                    
                    <div class="space-y-8">

                        <div class="mb-4 border-b border-zinc-800 pb-4">
                            <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Mis Bicicletas Guardadas</label>
                            <div class="flex gap-2">
                                <select id="tp-preset" onchange="loadTyreProfile(this.value)" class="w-full bg-black border border-zinc-700 rounded-xl px-3 py-3 text-xs md:text-sm text-purple-400 font-bold focus:border-purple-500 focus:outline-none transition-colors">
                                    <option value="default">锔 Nuevo / Sin Guardar</option>
                                </select>
                                <button onclick="deleteTyreProfilePrompt()" id="btn-delete-tp" class="hidden text-red-500/50 hover:text-red-400 p-3 rounded-xl border border-zinc-800 hover:bg-red-950/30 transition-colors"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between items-end mb-3">
                                <label class="block text-[10px] font-black text-zinc-400 uppercase tracking-widest">Peso Total (T煤 + Bici + Ropa)</label>
                                <span class="text-xs font-bold text-purple-400 font-mono bg-purple-950/50 px-2 py-1 rounded border border-purple-500/30">
                                    <span id="tp-weight-val">85</span> KG
                                </span>
                            </div>
                            <input type="range" min="50" max="130" value="85" class="slider-purple" id="tp-weight" oninput="updateTyrePressure()">
                        </div>

                        <div>
                            <div class="flex justify-between items-end mb-3">
                                <label class="block text-[10px] font-black text-zinc-400 uppercase tracking-widest">Ancho Real del Neum谩tico</label>
                                <span class="text-xs font-bold text-purple-400 font-mono bg-purple-950/50 px-2 py-1 rounded border border-purple-500/30">
                                    <span id="tp-width-val">28</span> MM
                                </span>
                            </div>
                            <input type="range" min="23" max="65" value="28" class="slider-purple" id="tp-width" oninput="updateTyrePressure()">
                            <p class="text-[9px] text-zinc-500 mt-2 text-right">Las llantas anchas pueden expandir tu cubierta entre 1 y 2 mm extra.</p>
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-zinc-400 uppercase tracking-widest mb-3">Modalidad</label>
                            <div class="grid grid-cols-3 gap-2" id="tp-discipline-container">
                                <button class="btn-terrain active py-3 px-1 md:px-2 rounded-xl text-[9px] md:text-[10px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="road">Carretera</button>
                                <button class="btn-terrain py-3 px-1 md:px-2 rounded-xl text-[9px] md:text-[10px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="gravel">Gravel / CX</button>
                                <button class="btn-terrain py-3 px-1 md:px-2 rounded-xl text-[9px] md:text-[10px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="mtb">MTB / XC</button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-zinc-400 uppercase tracking-widest mb-3">Condici贸n del Terreno</label>
                            <div class="grid grid-cols-3 gap-2" id="tp-terrain-container">
                                </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-zinc-400 uppercase tracking-widest mb-3">Sistema</label>
                            <div class="grid grid-cols-2 gap-2" id="tp-system-container">
                                <button class="btn-terrain active py-3 px-2 rounded-xl text-xs font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="1">Tubeless / Tubular</button>
                                <button class="btn-terrain py-3 px-2 rounded-xl text-xs font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="1.1">C谩mara (Butyl/Latex)</button>
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t border-zinc-800/50 mt-4">
                            <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Guardar este Setup de Presi贸n</label>
                            <div class="flex items-end gap-2">
                                <input type="text" id="tp-profile-name" placeholder="Ej: Tarmac Asfalto, Orbea Barro..." class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-3 py-2.5 text-xs text-white focus:border-purple-500 outline-none transition-colors">
                                <button onclick="saveTyreProfile()" class="bg-purple-600 hover:bg-purple-500 text-white font-bold text-[10px] px-4 py-2.5 rounded-xl uppercase tracking-widest transition-colors flex items-center shadow-lg shadow-purple-500/20 shrink-0">
                                    <i class="fas fa-save mr-1"></i> Guardar
                                </button>
                            </div>
                        </div>

                    </div>

                    <div class="flex flex-col justify-center">
                        <div class="bg-black/60 border border-purple-500/20 rounded-3xl p-6 md:p-8 relative overflow-hidden text-center shadow-inner h-full flex flex-col justify-center mt-6 lg:mt-0">
                            <div class="absolute inset-0 bg-gradient-to-b from-purple-900/20 to-transparent pointer-events-none"></div>
                            
                            <h3 class="text-sm font-black text-white italic uppercase tracking-widest mb-8 relative z-10">Presi贸n ptima Calculada</h3>
                            
                            <div class="grid grid-cols-2 gap-4 relative z-10 divide-x divide-zinc-800">
                                <div class="px-2">
                                    <span class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-4">
                                        <i class="fas fa-dot-circle mr-1"></i> Delantera
                                    </span>
                                    <div class="mb-1 flex items-baseline justify-center gap-1">
                                        <span id="tp-front-bar" class="text-4xl md:text-5xl font-black font-mono text-white tracking-tighter">0.0</span>
                                        <span class="text-xs font-bold text-purple-400">BAR</span>
                                    </div>
                                    <div>
                                        <span id="tp-front-psi" class="text-xl font-bold font-mono text-zinc-400">00</span>
                                        <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">PSI</span>
                                    </div>
                                </div>
                                
                                <div class="px-2">
                                    <span class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-4">
                                        <i class="fas fa-bullseye mr-1"></i> Trasera
                                    </span>
                                    <div class="mb-1 flex items-baseline justify-center gap-1">
                                        <span id="tp-rear-bar" class="text-4xl md:text-5xl font-black font-mono text-white tracking-tighter">0.0</span>
                                        <span class="text-xs font-bold text-purple-400">BAR</span>
                                    </div>
                                    <div>
                                        <span id="tp-rear-psi" class="text-xl font-bold font-mono text-zinc-400">00</span>
                                        <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">PSI</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-8 pt-6 border-t border-zinc-800/50 relative z-10 text-left">
                                <p class="text-[9px] text-zinc-500 uppercase tracking-widest font-bold mb-2">
                                    <i class="fas fa-info-circle text-purple-500 mr-1"></i> Velo Insight:
                                </p>
                                <p class="text-xs text-zinc-400 leading-relaxed font-mono">
                                    La rueda trasera soporta el mayor porcentaje de peso. Pasarse de presi贸n provoca "rebotes" microsc贸picos que disparan la fricci贸n (Crr) y te hacen perder vatios. M谩s duro no siempre es m谩s r谩pido.
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
            </section>
        </div>

    </main>

    <div id="delete-modal" class="fixed inset-0 z-[400] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4 transition-all opacity-0">
        <div class="bg-zinc-900 border border-zinc-700 rounded-2xl max-w-sm w-full p-6 shadow-2xl transform scale-95 transition-all">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-red-500/10 mb-4 mx-auto border border-red-500/30">
                <i class="fas fa-trash text-red-500 text-xl"></i>
            </div>
            <h3 class="text-lg font-black text-white text-center uppercase italic tracking-widest mb-2">Confirmar Borrado</h3>
            <p class="text-sm text-zinc-400 text-center mb-6">驴Est谩s seguro de que quieres eliminar <strong id="modal-bike-name" class="text-white"></strong> de tu garaje virtual?</p>
            <div class="flex gap-3">
                <button onclick="closeDeleteModal()" class="flex-1 px-4 py-2.5 rounded-xl border border-zinc-700 text-zinc-300 font-bold uppercase tracking-widest text-[10px] hover:bg-zinc-800 transition-colors">Cancelar</button>
                <button id="modal-confirm-btn" class="flex-1 px-4 py-2.5 rounded-xl bg-red-600 text-white font-black uppercase tracking-widest text-[10px] hover:bg-red-500 shadow-lg shadow-red-900/50 transition-colors">Borrar</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed bottom-6 right-6 z-[500] flex flex-col gap-3 pointer-events-none"></div>

    <script src="layout.js?v=7.1"></script>

    <script>
        // ==========================================
        // LGICA GEARING LAB
        // ==========================================
        let currentGradient = 0;
        let gradientLabel = "Llano 0%";

        function syncWeights() {
            const w = document.getElementById('system-weight').value;
            const wSlider = document.getElementById('tp-weight');
            if(wSlider && w >= wSlider.min && w <= wSlider.max) {
                wSlider.value = w;
                updateTyrePressure();
            }
        }

        function setGradient(percent, labelText) {
            currentGradient = percent;
            gradientLabel = labelText;
            
            const buttons = document.querySelectorAll('.gradient-btn');
            buttons.forEach(btn => btn.classList.remove('border-cyan-500/50', 'text-white'));
            
            const activeButton = [...buttons].find(btn => btn.innerText.includes(`${percent}%`));
            if(activeButton) activeButton.classList.add('border-cyan-500/50', 'text-white');
            
            calculateTelemetry();
        }

        const groupsetsDB = {
            shi_compact_11: { name: "11v Compact", platos: [50, 34], pinones: [11, 12, 13, 14, 15, 17, 19, 21, 24, 27, 30] },
            shi_semi_12: { name: "12v Semi-Compact", platos: [52, 36], pinones: [11, 12, 13, 14, 15, 16, 17, 19, 21, 24, 27, 30] },
            shi_pro_12: { name: "12v Pro", platos: [54, 40], pinones: [11, 12, 13, 14, 15, 16, 17, 19, 21, 24, 27, 30] },
            sram_red_12: { name: "SRAM 12v", platos: [48, 35], pinones: [10, 11, 12, 13, 14, 15, 17, 19, 21, 24, 28, 33] },
            campy_12: { name: "Campy 12v", platos: [50, 34], pinones: [11, 12, 13, 14, 15, 16, 17, 19, 22, 25, 28, 32] },
            grx_1x: { name: "Gravel 1x11", platos: [40], pinones: [11, 13, 15, 17, 19, 21, 24, 28, 32, 37, 42] },
            sram_xplr: { name: "XPLR 1x12", platos: [40], pinones: [10, 11, 13, 15, 17, 19, 21, 24, 28, 32, 38, 44] },
            campy_ekar: { name: "Ekar 13v", platos: [38], pinones: [9, 10, 11, 12, 13, 14, 15, 17, 20, 23, 27, 34, 42] },
            shi_xt_1x12: { name: "MTB 1x12", platos: [32], pinones: [10, 12, 14, 16, 18, 21, 24, 28, 33, 39, 45, 51] },
            sram_eagle: { name: "Eagle 1x12", platos: [32], pinones: [10, 12, 14, 16, 18, 21, 24, 28, 32, 38, 44, 52] },
            shi_mtb_2x: { name: "MTB 2x11", platos: [36, 26], pinones: [11, 13, 15, 17, 19, 21, 24, 28, 32, 37, 42] }
        };

        window.customMemoryA = { platos: "50, 34", pinones: "11, 12, 13, 14, 15, 17, 19, 21, 24, 28" };
        window.customMemoryB = { platos: "52, 36", pinones: "11, 12, 13, 14, 15, 17, 19, 21, 24, 28" };

        const rpmSlider = document.getElementById('rpm-slider');
        const rpmDisplay = document.getElementById('rpm-display');
        const rpmStatus = document.getElementById('rpm-status');
        const weightInput = document.getElementById('system-weight');

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const isError = type === 'error';
            toast.className = `p-4 rounded-xl shadow-2xl transform transition-all duration-300 translate-y-10 opacity-0 flex items-center gap-3 backdrop-blur-md ${isError ? 'bg-red-950/90 border border-red-500/50 text-red-200' : 'bg-emerald-950/90 border border-emerald-500/50 text-emerald-200'}`;
            toast.innerHTML = `<i class="fas ${isError ? 'fa-trash' : 'fa-check-circle'} text-lg"></i><span class="font-bold text-[10px] uppercase tracking-widest">${message}</span>`;
            
            document.getElementById('toast-container').appendChild(toast);
            
            requestAnimationFrame(() => { toast.classList.remove('translate-y-10', 'opacity-0'); });
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        window.toggleCustomWheel = function(id) {
            const select = document.getElementById(`wheel-${id}`);
            const container = document.getElementById(`custom-wheel-container-${id}`);
            if (select.value === 'custom') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
            calculateTelemetry();
        }

        window.copyShareLink = function() {
            const state = {
                rpm: rpmSlider.value,
                w: weightInput.value,
                g: currentGradient,
                wa: document.getElementById('wheel-a').value,
                cwa: document.getElementById('custom-wheel-a').value,
                pa: document.getElementById('preset-a').value,
                pla: document.getElementById('plato-a').value,
                pia: document.getElementById('pinon-a').value,
                wb: document.getElementById('wheel-b').value,
                cwb: document.getElementById('custom-wheel-b').value,
                pb: document.getElementById('preset-b').value,
                plb: document.getElementById('plato-b').value,
                pib: document.getElementById('pinon-b').value
            };
            const params = new URLSearchParams();
            for(let k in state) params.set(k, state[k]);
            
            const url = window.location.origin + window.location.pathname + '?share=1&' + params.toString();
            navigator.clipboard.writeText(url).then(() => {
                showToast("Enlace m谩gico copiado", "success");
            });
        }

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('share')) return false;

            if (params.has('rpm')) rpmSlider.value = params.get('rpm');
            if (params.has('w')) {
                weightInput.value = params.get('w');
                syncWeights();
            }
            if (params.has('g')) {
                let g = params.get('g');
                setGradient(parseInt(g), g == '8' ? 'Puerto 8%' : g == '12' ? 'Muro 12%' : 'Llano 0%');
            }

            ['a', 'b'].forEach(id => {
                if (params.has(`w${id}`)) {
                    document.getElementById(`wheel-${id}`).value = params.get(`w${id}`);
                    toggleCustomWheel(id);
                }
                if (params.has(`cw${id}`)) document.getElementById(`custom-wheel-${id}`).value = params.get(`cw${id}`);
                
                if (params.has(`p${id}`)) {
                    document.getElementById(`preset-${id}`).value = params.get(`p${id}`);
                    renderQuickSelects(id, true);
                }
                if (params.has(`pl${id}`)) document.getElementById(`plato-${id}`).value = params.get(`pl${id}`);
                if (params.has(`pi${id}`)) document.getElementById(`pinon-${id}`).value = params.get(`pi${id}`);
            });
            
            showToast("Setup cargado v铆a URL", "success");
            return true;
        }

        function updateSelectOptions(setupId) {
            const select = document.getElementById(`preset-${setupId}`);
            const savedVal = select.value; 

            const oldGroup = select.querySelector('optgroup[label="猸 Mis Bicicletas (Guardadas)"]');
            if(oldGroup) oldGroup.remove();

            const savedProfiles = JSON.parse(localStorage.getItem('velo_user_profiles')) || {};
            if(Object.keys(savedProfiles).length > 0) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = "猸 Mis Bicicletas (Guardadas)";
                
                for(const key in savedProfiles) {
                    const opt = document.createElement('option');
                    opt.value = key;
                    opt.innerText = savedProfiles[key].name;
                    optgroup.appendChild(opt);
                    groupsetsDB[key] = savedProfiles[key];
                }
                select.insertBefore(optgroup, select.children[1]);
            }
            if(select.querySelector(`option[value="${savedVal}"]`)) select.value = savedVal;
        }

        function renderQuickSelects(setupId, skipAutoSelect = false) {
            const presetVal = document.getElementById(`preset-${setupId}`).value;
            const container = document.getElementById(`quick-selects-${setupId}`);
            
            const colorClass = setupId === 'a' ? 'cyan' : 'violet';
            const bgClass = `bg-${colorClass}-900/30`;
            const textClass = `text-${colorClass}-400`;
            const borderClass = `border-${colorClass}-500/30`;
            const hoverClass = `hover:bg-${colorClass}-500 hover:text-black`;

            container.classList.remove('hidden');

            if (presetVal === 'custom') {
                const mem = setupId === 'a' ? window.customMemoryA : window.customMemoryB;
                container.innerHTML = `
                    <div class="mb-2 grid grid-cols-1 gap-2 border-b border-zinc-800 pb-3">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[8px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Mis Platos</label>
                                <input type="text" id="custom-platos-${setupId}" value="${mem.platos}" oninput="buildCustomButtons('${setupId}')" class="w-full bg-black border border-zinc-700 rounded-lg px-2 py-1.5 text-xs text-white font-mono focus:border-${colorClass}-500 outline-none transition-colors" placeholder="Ej: 50, 34">
                            </div>
                            <div>
                                <label class="block text-[8px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Mi Cassette</label>
                                <input type="text" id="custom-pinones-${setupId}" value="${mem.pinones}" oninput="buildCustomButtons('${setupId}')" class="w-full bg-black border border-zinc-700 rounded-lg px-2 py-1.5 text-xs text-white font-mono focus:border-${colorClass}-500 outline-none transition-colors" placeholder="Ej: 11, 13, 15...">
                            </div>
                        </div>
                        <div class="flex items-end gap-2 mt-1">
                            <div class="flex-1">
                                <label class="block text-[8px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Guardar Perfil</label>
                                <input type="text" id="profile-name-${setupId}" placeholder="Ej: Trek Emonda" class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-2 py-1.5 text-xs text-white focus:border-${colorClass}-500 outline-none transition-colors">
                            </div>
                            <button onclick="saveCustomProfile('${setupId}')" class="bg-${colorClass}-600 hover:bg-${colorClass}-500 text-black font-bold text-[10px] px-3 py-1.5 rounded-lg uppercase tracking-widest transition-colors h-[30px] flex items-center shadow-lg shadow-${colorClass}-500/20 shrink-0">
                                <i class="fas fa-save mr-1"></i> Guardar
                            </button>
                        </div>
                    </div>
                    <div id="custom-buttons-container-${setupId}" class="mt-2"></div>
                `;
                buildCustomButtons(setupId, skipAutoSelect);
                return;
            }

            const data = groupsetsDB[presetVal];
            
            // Botones de Platos (RESPONSIVOS: Peque帽os en m贸vil, Grandes en PC)
            const platosHTML = data.platos.map(p => 
                `<button onclick="setGear('${setupId}', 'plato', ${p})" class="btn-gear px-3 py-1.5 md:px-4 md:py-2 rounded-xl border ${borderClass} ${bgClass} ${textClass} ${hoverClass} text-sm md:text-base font-black font-mono shadow-sm">${p}T</button>`
            ).join('');

            // Botones de Pi帽ones (RESPONSIVOS)
            const pinonesHTML = data.pinones.map(p => 
                `<button onclick="setGear('${setupId}', 'pinon', ${p})" class="btn-gear px-2.5 py-1.5 md:px-3 md:py-2 rounded-lg bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-white hover:text-black hover:border-white text-xs md:text-sm font-bold font-mono transition-colors shadow-sm">${p}</button>`
            ).join('');

            const deleteBtn = data.isUser ? `<button onclick="confirmDeleteProfile('${presetVal}', '${setupId}')" class="text-red-500/50 hover:text-red-400 p-2 rounded-lg hover:bg-red-950/30 transition-colors" title="Borrar perfil"><i class="fas fa-trash"></i></button>` : '';

            container.innerHTML = `
                <div class="mb-4 flex items-center gap-3 md:gap-4">
                    <div class="w-16 shrink-0">
                        <span class="block text-[9px] md:text-[11px] font-bold text-zinc-500 uppercase tracking-widest">Platos:</span>
                        <span class="block text-xs md:text-sm font-black text-${colorClass}-500 mt-1">${data.platos.length}x</span>
                    </div>
                    <div class="flex gap-2 flex-wrap flex-1">${platosHTML}</div>
                    ${deleteBtn}
                </div>
                <div class="flex items-start gap-3 md:gap-4">
                    <div class="w-16 shrink-0 mt-2">
                        <span class="block text-[9px] md:text-[11px] font-bold text-zinc-500 uppercase tracking-widest">Cassette:</span>
                        <span class="block text-xs md:text-sm font-black text-${colorClass}-500 mt-1">${data.pinones.length}v</span>
                    </div>
                    <div class="flex flex-wrap gap-1.5 md:gap-2 flex-1">${pinonesHTML}</div>
                </div>
            `;

            if (!skipAutoSelect) {
                document.getElementById(`plato-${setupId}`).value = data.platos[0];
                document.getElementById(`pinon-${setupId}`).value = data.pinones[Math.floor(data.pinones.length / 2)];
                calculateTelemetry();
            }
        }

        window.buildCustomButtons = function(setupId, skipAutoSelect = false) {
            const platosStr = document.getElementById(`custom-platos-${setupId}`).value;
            const pinonesStr = document.getElementById(`custom-pinones-${setupId}`).value;

            const platosArr = platosStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0);
            const pinonesArr = pinonesStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0).sort((a,b)=>a-b);

            groupsetsDB[`custom_${setupId}`] = { platos: platosArr, pinones: pinonesArr };
            
            if(setupId === 'a') window.customMemoryA = { platos: platosStr, pinones: pinonesStr };
            if(setupId === 'b') window.customMemoryB = { platos: platosStr, pinones: pinonesStr };

            const colorClass = setupId === 'a' ? 'cyan' : 'violet';
            const bgClass = `bg-${colorClass}-900/30`;
            const textClass = `text-${colorClass}-400`;
            const borderClass = `border-${colorClass}-500/30`;
            const hoverClass = `hover:bg-${colorClass}-500 hover:text-black`;

            const platosHTML = platosArr.map(p => 
                `<button onclick="setGear('${setupId}', 'plato', ${p})" class="btn-gear px-3 py-1.5 md:px-4 md:py-2 rounded-xl border ${borderClass} ${bgClass} ${textClass} ${hoverClass} text-sm md:text-base font-black font-mono shadow-sm">${p}T</button>`
            ).join('');

            const pinonesHTML = pinonesArr.map(p => 
                `<button onclick="setGear('${setupId}', 'pinon', ${p})" class="btn-gear px-2.5 py-1.5 md:px-3 md:py-2 rounded-lg bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-white hover:text-black hover:border-white text-xs md:text-sm font-bold font-mono transition-colors shadow-sm">${p}</button>`
            ).join('');

            const targetDiv = document.getElementById(`custom-buttons-container-${setupId}`);
            if(targetDiv) {
                targetDiv.innerHTML = `
                    <div class="mb-4 flex items-center gap-3 md:gap-4">
                        <div class="w-16 shrink-0">
                            <span class="block text-[9px] md:text-[11px] font-bold text-zinc-500 uppercase tracking-widest">Platos:</span>
                            <span class="block text-xs md:text-sm font-black text-${colorClass}-500 mt-1">${platosArr.length}x</span>
                        </div>
                        <div class="flex gap-2 flex-wrap flex-1">${platosHTML || '<span class="text-[10px] text-zinc-600">--</span>'}</div>
                    </div>
                    <div class="flex items-start gap-3 md:gap-4">
                        <div class="w-16 shrink-0 mt-2">
                            <span class="block text-[9px] md:text-[11px] font-bold text-zinc-500 uppercase tracking-widest">Cassette:</span>
                            <span class="block text-xs md:text-sm font-black text-${colorClass}-500 mt-1">${pinonesArr.length}v</span>
                        </div>
                        <div class="flex flex-wrap gap-1.5 md:gap-2 flex-1">${pinonesHTML || '<span class="text-[10px] text-zinc-600">--</span>'}</div>
                    </div>
                `;
            }

            if (!skipAutoSelect) calculateTelemetry(); 
        };

        window.saveCustomProfile = function(setupId) {
            const nameInput = document.getElementById(`profile-name-${setupId}`);
            const name = nameInput.value.trim();
            if(!name) { alert("Por favor, ponle un nombre a tu bicicleta."); return; }

            const platosStr = document.getElementById(`custom-platos-${setupId}`).value;
            const pinonesStr = document.getElementById(`custom-pinones-${setupId}`).value;

            const platosArr = platosStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0);
            const pinonesArr = pinonesStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0).sort((a,b)=>a-b);

            if(platosArr.length === 0 || pinonesArr.length === 0) return;

            const profileId = 'user_bike_' + Date.now(); 
            const newProfile = { name: name, platos: platosArr, pinones: pinonesArr, isUser: true };

            const savedProfiles = JSON.parse(localStorage.getItem('velo_user_profiles')) || {};
            savedProfiles[profileId] = newProfile;
            localStorage.setItem('velo_user_profiles', JSON.stringify(savedProfiles));

            updateSelectOptions('a'); updateSelectOptions('b');
            document.getElementById(`preset-${setupId}`).value = profileId;
            renderQuickSelects(setupId, false);
            
            showToast(`Perfil "${name}" guardado`, 'success');
        };

        // LGICA COMPARTIDA PARA BORRAR PERFILES (GEARS vs TYRES)
        let profileToDelete = null; 
        let setupIdToDelete = null;

        window.confirmDeleteProfile = function(profileId, setupId) {
            profileToDelete = profileId; 
            setupIdToDelete = setupId;
            const savedProfiles = JSON.parse(localStorage.getItem('velo_user_profiles')) || {};
            document.getElementById('modal-bike-name').innerText = savedProfiles[profileId]?.name || 'Grupo';
            
            const confirmBtn = document.getElementById('modal-confirm-btn');
            confirmBtn.onclick = executeDeleteGearProfile;

            const modal = document.getElementById('delete-modal');
            modal.classList.remove('hidden');
            requestAnimationFrame(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
            });
        };

        window.executeDeleteGearProfile = function() {
            if(!profileToDelete) return;
            const savedProfiles = JSON.parse(localStorage.getItem('velo_user_profiles')) || {};
            const profileName = savedProfiles[profileToDelete]?.name || 'Grupo';
            delete savedProfiles[profileToDelete];
            localStorage.setItem('velo_user_profiles', JSON.stringify(savedProfiles));
            delete groupsetsDB[profileToDelete];
            updateSelectOptions('a'); updateSelectOptions('b');

            document.getElementById(`preset-${setupIdToDelete}`).value = 'custom';
            renderQuickSelects(setupIdToDelete, false);
            closeDeleteModal();
            showToast(`Eliminado: ${profileName}`, 'error'); 
        };

        window.closeDeleteModal = function() {
            const modal = document.getElementById('delete-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
            profileToDelete = null; setupIdToDelete = null;
        };

        window.setGear = function(setupId, type, value) {
            document.getElementById(`${type}-${setupId}`).value = value;
            calculateTelemetry();
        };

        function saveConfigToMemory() {
            const config = {
                rpm: rpmSlider.value, weight: weightInput.value,
                a: { 
                    wheel: document.getElementById('wheel-a').value, cwheel: document.getElementById('custom-wheel-a').value,
                    preset: document.getElementById('preset-a').value, plato: document.getElementById('plato-a').value, pinon: document.getElementById('pinon-a').value,
                    customP: window.customMemoryA.platos, customC: window.customMemoryA.pinones
                },
                b: { 
                    wheel: document.getElementById('wheel-b').value, cwheel: document.getElementById('custom-wheel-b').value,
                    preset: document.getElementById('preset-b').value, plato: document.getElementById('plato-b').value, pinon: document.getElementById('pinon-b').value,
                    customP: window.customMemoryB.platos, customC: window.customMemoryB.pinones
                }
            };
            localStorage.setItem('velo_calc_memory', JSON.stringify(config));
        }

        function loadConfigFromMemory() {
            updateSelectOptions('a'); updateSelectOptions('b');
            const saved = localStorage.getItem('velo_calc_memory');
            if (saved) {
                const config = JSON.parse(saved);
                rpmSlider.value = config.rpm || 90; 
                weightInput.value = config.weight || 85;
                syncWeights();

                window.customMemoryA = { platos: config.a.customP || "50, 34", pinones: config.a.customC || "11, 12, 13, 14, 15, 17, 19, 21, 24, 28" };
                window.customMemoryB = { platos: config.b.customP || "52, 36", pinones: config.b.customC || "11, 12, 13, 14, 15, 17, 19, 21, 24, 28" };

                document.getElementById('wheel-a').value = config.a.wheel;
                if(config.a.cwheel) document.getElementById('custom-wheel-a').value = config.a.cwheel;
                toggleCustomWheel('a');
                document.getElementById('preset-a').value = config.a.preset;
                renderQuickSelects('a', true);
                document.getElementById('plato-a').value = config.a.plato;
                document.getElementById('pinon-a').value = config.a.pinon;

                document.getElementById('wheel-b').value = config.b.wheel;
                if(config.b.cwheel) document.getElementById('custom-wheel-b').value = config.b.cwheel;
                toggleCustomWheel('b');
                document.getElementById('preset-b').value = config.b.preset;
                renderQuickSelects('b', true);
                document.getElementById('plato-b').value = config.b.plato;
                document.getElementById('pinon-b').value = config.b.pinon;
            } else {
                renderQuickSelects('a'); renderQuickSelects('b');
            }
        }

        function checkCrossChain(setupId, plato, pinon, preset) {
            let isCrossed = false;
            const data = preset === 'custom' ? groupsetsDB[`custom_${setupId}`] : groupsetsDB[preset];
            
            if (data && data.platos.length > 1 && data.pinones.length > 1) {
                const isBigRing = plato === data.platos[0]; 
                const isSmallRing = plato === data.platos[data.platos.length - 1]; 
                const sortedCogs = [...data.pinones].sort((a,b) => a - b);
                const cogIndex = sortedCogs.indexOf(pinon);
                
                if (cogIndex !== -1) {
                    if (isBigRing && cogIndex >= sortedCogs.length - 2) isCrossed = true; 
                    if (isSmallRing && cogIndex <= 1) isCrossed = true; 
                } else {
                    if (isBigRing && pinon >= sortedCogs[sortedCogs.length - 2]) isCrossed = true;
                    if (isSmallRing && pinon <= sortedCogs[1]) isCrossed = true;
                }
            }
            const warningEl = document.getElementById(`crosschain-warning-${setupId}`);
            if (isCrossed) warningEl.classList.remove('hidden'); else warningEl.classList.add('hidden');
        }

        function calculateTelemetry() {
            const rpm = parseInt(rpmSlider.value) || 90;
            const currentWeight = parseInt(weightInput.value) || 85; 

            rpmDisplay.innerText = rpm;
            rpmDisplay.className = "text-6xl md:text-8xl font-black italic tracking-tighter neon-text leading-none transition-colors duration-300 ";
            rpmStatus.className = "inline-block mt-3 text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded border transition-colors duration-300 ";

            if (rpm < 70) {
                rpmDisplay.classList.add("text-red-500"); rpmStatus.classList.add("text-red-400", "border-red-500/30", "bg-red-950/30"); rpmStatus.innerText = "ATRANCADO (Fuerza)";
            } else if (rpm <= 85) {
                rpmDisplay.classList.add("text-amber-500"); rpmStatus.classList.add("text-amber-400", "border-amber-500/30", "bg-amber-950/30"); rpmStatus.innerText = "ZONA DE POTENCIA";
            } else if (rpm <= 105) {
                rpmDisplay.classList.add("text-emerald-500"); rpmStatus.classList.add("text-emerald-400", "border-emerald-500/30", "bg-emerald-950/30"); rpmStatus.innerText = "ZONA PTIMA / GIL";
            } else {
                rpmDisplay.classList.add("text-cyan-500"); rpmStatus.classList.add("text-cyan-400", "border-cyan-500/30", "bg-cyan-950/30"); rpmStatus.innerText = "MOLINILLO (Alta FRQ)";
            }

            const calcSide = (id) => {
                const plato = Math.max(1, parseInt(document.getElementById(`plato-${id}`).value) || 1);
                const pinon = Math.max(1, parseInt(document.getElementById(`pinon-${id}`).value) || 1);
                
                let wheelVal = document.getElementById(`wheel-${id}`).value;
                let circ = wheelVal === 'custom' ? (parseInt(document.getElementById(`custom-wheel-${id}`).value) || 2150) / 1000 : parseInt(wheelVal) / 1000;
                
                const preset = document.getElementById(`preset-${id}`).value;

                checkCrossChain(id, plato, pinon, preset);

                const ratio = plato / pinon;
                const dev = ratio * circ; 
                
                const speed = (dev * rpm * 60) / 1000; 
                const speed60 = (dev * 60 * 60) / 1000;
                const speed90 = (dev * 90 * 60) / 1000;
                const speed110 = (dev * 110 * 60) / 1000;

                document.getElementById(`ratio-${id}`).innerText = ratio.toFixed(2);
                document.getElementById(`dev-${id}`).innerText = dev.toFixed(2) + 'm';
                document.getElementById(`speed-${id}`).innerText = speed.toFixed(1);
                document.getElementById(`speed-${id}-60`).innerText = speed60.toFixed(1);
                document.getElementById(`speed-${id}-90`).innerText = speed90.toFixed(1);
                document.getElementById(`speed-${id}-110`).innerText = speed110.toFixed(1);

                const CdA = 0.32; const Crr = 0.004; const g = 9.81; const v = speed / 3.6; 
                const slopeIncline = currentGradient / 100;
                const powerSlope = currentWeight * g * slopeIncline * v; 
                const powerWind = 0.5 * 1.225 * CdA * (v * v * v); 
                const powerRolling = currentWeight * g * Crr * v; 

                const totalPower = Math.max(0, (powerSlope + powerWind + powerRolling) / 0.97);
                const wkg = totalPower / currentWeight;

                document.getElementById(`power-label-${id}`).innerText = `Potencia (${gradientLabel})`;
                document.getElementById(`power-${id}`).innerText = `${Math.round(totalPower)} W`;
                document.getElementById(`wkg-${id}`).innerText = wkg.toFixed(1);
                
                const wkgEl = document.getElementById(`wkg-${id}`);
                wkgEl.className = "text-lg md:text-xl font-black font-mono ";
                if(wkg < 3) wkgEl.classList.add("text-zinc-400");
                else if(wkg < 4.5) wkgEl.classList.add("text-emerald-400");
                else if(wkg < 6) wkgEl.classList.add("text-amber-400");
                else wkgEl.classList.add("text-red-500", "animate-pulse"); 
            };

            calcSide('a'); calcSide('b');
            
            const rpmPercent = ((rpm - rpmSlider.min) / (rpmSlider.max - rpmSlider.min)) * 100;
            rpmSlider.style.setProperty('--val', `${rpmPercent}%`);
            
            saveConfigToMemory();
        }

        rpmSlider.addEventListener('input', calculateTelemetry);
        weightInput.addEventListener('input', calculateTelemetry);
        
        ['a', 'b'].forEach(id => {
            document.getElementById(`custom-wheel-${id}`).addEventListener('input', calculateTelemetry);
            document.getElementById(`plato-${id}`).addEventListener('input', calculateTelemetry);
            document.getElementById(`pinon-${id}`).addEventListener('input', calculateTelemetry);
            document.getElementById(`preset-${id}`).addEventListener('change', () => { renderQuickSelects(id, false); });
        });


        // ==========================================
        // LGICA TYRE PRESSURE LAB (MOTOR REESCRITO)
        // ==========================================
        
        const terrenos = {
            road: [
                { id: 'smooth', label: 'Asfalto Perfecto', mult: 1.0 },
                { id: 'rough', label: 'Asfalto Roto', mult: 0.95 },
                { id: 'cobbles', label: 'Adoquines', mult: 0.85 }
            ],
            gravel: [
                { id: 'smooth', label: 'Pista R谩pida', mult: 1.0 },
                { id: 'rough', label: 'Grava Suelta', mult: 0.95 },
                { id: 'cobbles', label: 'T茅cnico/Barro', mult: 0.90 }
            ],
            mtb: [
                { id: 'smooth', label: 'XC Hardpack', mult: 1.0 },
                { id: 'rough', label: 'Trail / Ra铆ces', mult: 0.95 },
                { id: 'cobbles', label: 'Enduro / Drop', mult: 0.90 }
            ]
        };

        let tpDiscipline = 'road'; 
        let tpTerrainFactor = 1.0; 
        let tpSystemFactor = 1.0; 

        const tpWeightSlider = document.getElementById('tp-weight');
        const tpWidthSlider = document.getElementById('tp-width');
        
        function updateTerrainButtons(discipline) {
            const container = document.getElementById('tp-terrain-container');
            const opts = terrenos[discipline];
            
            container.innerHTML = opts.map((t, index) => `
                <button class="btn-terrain-sub ${index === 0 ? 'active' : ''} py-3 px-1 md:px-2 rounded-xl text-[9px] md:text-[10px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-900/50" data-val="${t.mult}">
                    ${t.label}
                </button>
            `).join('');

            tpTerrainFactor = opts[0].mult;

            document.querySelectorAll('#tp-terrain-container .btn-terrain-sub').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('#tp-terrain-container .btn-terrain-sub').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    tpTerrainFactor = parseFloat(e.target.dataset.val);
                    updateTyrePressure();
                });
            });
        }

        function updateTyrePressure() {
            const w = parseInt(tpWeightSlider.value);
            const width = parseInt(tpWidthSlider.value);
            
            document.getElementById('tp-weight-val').innerText = w;
            document.getElementById('tp-width-val').innerText = width;

            // FRMULA VELO INSIGHTS (Mejorada para Road, Gravel y MTB)
            let basePSI = 90 * (w / 85) * Math.pow((28 / width), 1.6);
            
            let disciplineMult = 1.0; 
            if(tpDiscipline === 'gravel') disciplineMult = 0.85; 
            if(tpDiscipline === 'mtb') disciplineMult = 0.75; 

            let optimalPSI_rear = basePSI * disciplineMult * tpTerrainFactor * tpSystemFactor;
            
            optimalPSI_rear = Math.min(120, Math.max(15, optimalPSI_rear));
            const optimalPSI_front = optimalPSI_rear * 0.94;

            const barRear = (optimalPSI_rear / 14.5038).toFixed(2);
            const barFront = (optimalPSI_front / 14.5038).toFixed(2);

            document.getElementById('tp-rear-psi').innerText = Math.round(optimalPSI_rear);
            document.getElementById('tp-rear-bar').innerText = barRear;
            
            document.getElementById('tp-front-psi').innerText = Math.round(optimalPSI_front);
            document.getElementById('tp-front-bar').innerText = barFront;
        }

        // ==========================================
        // PERFILES GUARDADOS DE NEUMTICOS
        // ==========================================
        
        function renderTyreProfiles() {
            const select = document.getElementById('tp-preset');
            const savedVal = select.value;
            const oldGroup = select.querySelector('optgroup');
            if(oldGroup) oldGroup.remove();

            const savedProfiles = JSON.parse(localStorage.getItem('velo_tp_profiles')) || {};
            if(Object.keys(savedProfiles).length > 0) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = "猸 Mis Configuraciones";
                for(const key in savedProfiles) {
                    const opt = document.createElement('option');
                    opt.value = key;
                    opt.innerText = savedProfiles[key].name;
                    optgroup.appendChild(opt);
                }
                select.appendChild(optgroup);
            }
            if(select.querySelector(`option[value="${savedVal}"]`)) select.value = savedVal;
            
            const delBtn = document.getElementById('btn-delete-tp');
            if (select.value !== 'default') delBtn.classList.remove('hidden');
            else delBtn.classList.add('hidden');
        }

        window.saveTyreProfile = function() {
            const nameInput = document.getElementById('tp-profile-name');
            const name = nameInput.value.trim();
            if(!name) { alert("Ponle un nombre a tu configuraci贸n de presi贸n."); return; }

            const profileId = 'tp_bike_' + Date.now();
            const newProfile = {
                name: name,
                weight: tpWeightSlider.value,
                width: tpWidthSlider.value,
                discipline: tpDiscipline,
                terrain: tpTerrainFactor,
                system: tpSystemFactor
            };

            const savedProfiles = JSON.parse(localStorage.getItem('velo_tp_profiles')) || {};
            savedProfiles[profileId] = newProfile;
            localStorage.setItem('velo_tp_profiles', JSON.stringify(savedProfiles));

            renderTyreProfiles();
            document.getElementById('tp-preset').value = profileId;
            document.getElementById('btn-delete-tp').classList.remove('hidden');
            nameInput.value = '';
            showToast(`Presiones de "${name}" guardadas`, 'success');
        };

        window.loadTyreProfile = function(profileId) {
            const delBtn = document.getElementById('btn-delete-tp');
            if(profileId === 'default') {
                delBtn.classList.add('hidden');
                return;
            }
            delBtn.classList.remove('hidden');

            const savedProfiles = JSON.parse(localStorage.getItem('velo_tp_profiles')) || {};
            const p = savedProfiles[profileId];
            if(p) {
                tpWeightSlider.value = p.weight;
                tpWidthSlider.value = p.width;
                tpDiscipline = p.discipline;
                tpSystemFactor = p.system;
                
                updateTerrainButtons(tpDiscipline);
                tpTerrainFactor = p.terrain;
                
                // Update UI Buttons visually
                document.querySelectorAll('#tp-discipline-container .btn-terrain').forEach(b => {
                    b.classList.remove('active');
                    if(b.dataset.val === tpDiscipline) b.classList.add('active');
                });
                document.querySelectorAll('#tp-system-container .btn-terrain').forEach(b => {
                    b.classList.remove('active');
                    if(parseFloat(b.dataset.val) === tpSystemFactor) b.classList.add('active');
                });
                document.querySelectorAll('#tp-terrain-container .btn-terrain-sub').forEach(b => {
                    b.classList.remove('active');
                    if(parseFloat(b.dataset.val) === tpTerrainFactor) b.classList.add('active');
                });

                updateTyrePressure();
                document.getElementById('system-weight').value = p.weight;
                calculateTelemetry();
            }
        };

        window.deleteTyreProfilePrompt = function() {
            const select = document.getElementById('tp-preset');
            if(select.value === 'default') return;
            
            profileToDelete = select.value;
            const savedProfiles = JSON.parse(localStorage.getItem('velo_tp_profiles')) || {};
            document.getElementById('modal-bike-name').innerText = savedProfiles[profileToDelete]?.name || 'esta configuraci贸n de presiones';
            
            const confirmBtn = document.getElementById('modal-confirm-btn');
            confirmBtn.onclick = executeDeleteTyreProfile;

            const modal = document.getElementById('delete-modal');
            modal.classList.remove('hidden');
            requestAnimationFrame(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
            });
        };

        window.executeDeleteTyreProfile = function() {
            if(!profileToDelete) return;
            const savedProfiles = JSON.parse(localStorage.getItem('velo_tp_profiles')) || {};
            const profileName = savedProfiles[profileToDelete]?.name || 'Configuraci贸n';
            delete savedProfiles[profileToDelete];
            localStorage.setItem('velo_tp_profiles', JSON.stringify(savedProfiles));
            
            document.getElementById('tp-preset').value = 'default';
            renderTyreProfiles();
            closeDeleteModal();
            showToast(`Eliminado: ${profileName}`, 'error');
        };

        // Listeners b谩sicos de Presiones
        document.querySelectorAll('#tp-discipline-container .btn-terrain').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('#tp-discipline-container .btn-terrain').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                tpDiscipline = e.target.dataset.val;
                updateTerrainButtons(tpDiscipline); 
                updateTyrePressure();
                document.getElementById('tp-preset').value = 'default';
                document.getElementById('btn-delete-tp').classList.add('hidden');
            });
        });

        document.querySelectorAll('#tp-system-container .btn-terrain').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('#tp-system-container .btn-terrain').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                tpSystemFactor = parseFloat(e.target.dataset.val);
                updateTyrePressure();
                document.getElementById('tp-preset').value = 'default';
                document.getElementById('btn-delete-tp').classList.add('hidden');
            });
        });

        tpWeightSlider.addEventListener('input', () => {
            document.getElementById('system-weight').value = tpWeightSlider.value;
            calculateTelemetry(); 
            updateTyrePressure();
        });
        
        tpWidthSlider.addEventListener('input', updateTyrePressure);

        // ==========================================
        // INIT GLOBAL DE LA PGINA
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            if (!loadFromURL()) {
                loadConfigFromMemory(); 
                setGradient(0, 'Llano 0%'); 
            } else {
                calculateTelemetry();
            }

            renderTyreProfiles();
            updateTerrainButtons(tpDiscipline);
            syncWeights();
            updateTyrePressure();
        });
    </script>
</body>
</html>
